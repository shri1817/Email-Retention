{"version":3,"sources":["useActiveDescendant.js"],"sourcesContent":["import * as React from 'react';\nimport { useEventCallback, useMergedRefs } from '@fluentui/react-utilities';\nimport { useOnKeyboardNavigationChange } from '@fluentui/react-tabster';\nimport { useOptionWalker } from './useOptionWalker';\nimport { ACTIVEDESCENDANT_ATTRIBUTE, ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE } from './constants';\nimport { scrollIntoView } from './scrollIntoView';\nexport function useActiveDescendant(options) {\n    const { imperativeRef, matchOption: matchOptionUnstable } = options;\n    const focusVisibleRef = React.useRef(false);\n    const activeIdRef = React.useRef(null);\n    const activeParentRef = React.useRef(null);\n    const attributeVisibilityRef = React.useRef(true);\n    const removeAttribute = React.useCallback(()=>{\n        var _activeParentRef_current;\n        (_activeParentRef_current = activeParentRef.current) === null || _activeParentRef_current === void 0 ? void 0 : _activeParentRef_current.removeAttribute('aria-activedescendant');\n    }, []);\n    const setAttribute = React.useCallback((id)=>{\n        if (id) {\n            activeIdRef.current = id;\n        }\n        if (attributeVisibilityRef.current && activeIdRef.current) {\n            var _activeParentRef_current;\n            (_activeParentRef_current = activeParentRef.current) === null || _activeParentRef_current === void 0 ? void 0 : _activeParentRef_current.setAttribute('aria-activedescendant', activeIdRef.current);\n        }\n    }, []);\n    useOnKeyboardNavigationChange((isNavigatingWithKeyboard)=>{\n        focusVisibleRef.current = isNavigatingWithKeyboard;\n        const active = getActiveDescendant();\n        if (!active) {\n            return;\n        }\n        if (isNavigatingWithKeyboard) {\n            active.setAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE, '');\n        } else {\n            active.removeAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE);\n        }\n    });\n    const matchOption = useEventCallback(matchOptionUnstable);\n    const listboxRef = React.useRef(null);\n    const { optionWalker, listboxCallbackRef } = useOptionWalker({\n        matchOption\n    });\n    const getActiveDescendant = React.useCallback(()=>{\n        var _listboxRef_current;\n        return (_listboxRef_current = listboxRef.current) === null || _listboxRef_current === void 0 ? void 0 : _listboxRef_current.querySelector(`#${activeIdRef.current}`);\n    }, [\n        listboxRef\n    ]);\n    const blurActiveDescendant = React.useCallback(()=>{\n        const active = getActiveDescendant();\n        if (active) {\n            active.removeAttribute(ACTIVEDESCENDANT_ATTRIBUTE);\n            active.removeAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE);\n        }\n        removeAttribute();\n        activeIdRef.current = null;\n    }, [\n        getActiveDescendant,\n        removeAttribute\n    ]);\n    const focusActiveDescendant = React.useCallback((nextActive)=>{\n        if (!nextActive) {\n            return;\n        }\n        blurActiveDescendant();\n        scrollIntoView(nextActive, listboxRef.current);\n        setAttribute(nextActive.id);\n        nextActive.setAttribute(ACTIVEDESCENDANT_ATTRIBUTE, '');\n        if (focusVisibleRef.current) {\n            nextActive.setAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE, '');\n        }\n    }, [\n        listboxRef,\n        blurActiveDescendant,\n        setAttribute\n    ]);\n    const controller = React.useMemo(()=>({\n            first: ({ passive } = {})=>{\n                const first = optionWalker.first();\n                if (!passive) {\n                    focusActiveDescendant(first);\n                }\n                return first === null || first === void 0 ? void 0 : first.id;\n            },\n            last: ({ passive } = {})=>{\n                const last = optionWalker.last();\n                if (!passive) {\n                    focusActiveDescendant(last);\n                }\n                return last === null || last === void 0 ? void 0 : last.id;\n            },\n            next: ({ passive } = {})=>{\n                const active = getActiveDescendant();\n                if (!active) {\n                    return;\n                }\n                optionWalker.setCurrent(active);\n                const next = optionWalker.next();\n                if (!passive) {\n                    focusActiveDescendant(next);\n                }\n                return next === null || next === void 0 ? void 0 : next.id;\n            },\n            prev: ({ passive } = {})=>{\n                const active = getActiveDescendant();\n                if (!active) {\n                    return;\n                }\n                optionWalker.setCurrent(active);\n                const next = optionWalker.prev();\n                if (!passive) {\n                    focusActiveDescendant(next);\n                }\n                return next === null || next === void 0 ? void 0 : next.id;\n            },\n            blur: ()=>{\n                blurActiveDescendant();\n            },\n            active: ()=>{\n                var _getActiveDescendant;\n                return (_getActiveDescendant = getActiveDescendant()) === null || _getActiveDescendant === void 0 ? void 0 : _getActiveDescendant.id;\n            },\n            focus: (id)=>{\n                if (!listboxRef.current) {\n                    return;\n                }\n                const target = listboxRef.current.querySelector(`#${id}`);\n                if (target) {\n                    focusActiveDescendant(target);\n                }\n            },\n            find (predicate, { passive, startFrom } = {}) {\n                const target = optionWalker.find(predicate, startFrom);\n                if (!passive) {\n                    focusActiveDescendant(target);\n                }\n                return target === null || target === void 0 ? void 0 : target.id;\n            },\n            showAttributes () {\n                attributeVisibilityRef.current = true;\n                setAttribute();\n            },\n            hideAttributes () {\n                attributeVisibilityRef.current = false;\n                removeAttribute();\n            }\n        }), [\n        optionWalker,\n        listboxRef,\n        setAttribute,\n        removeAttribute,\n        focusActiveDescendant,\n        blurActiveDescendant,\n        getActiveDescendant\n    ]);\n    React.useImperativeHandle(imperativeRef, ()=>controller);\n    return {\n        listboxRef: useMergedRefs(listboxRef, listboxCallbackRef),\n        activeParentRef,\n        controller\n    };\n}\n"],"names":["useActiveDescendant","options","imperativeRef","matchOption","matchOptionUnstable","focusVisibleRef","React","useRef","activeIdRef","activeParentRef","attributeVisibilityRef","removeAttribute","useCallback","_activeParentRef_current","current","setAttribute","id","useOnKeyboardNavigationChange","isNavigatingWithKeyboard","active","getActiveDescendant","ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE","useEventCallback","listboxRef","optionWalker","listboxCallbackRef","useOptionWalker","_listboxRef_current","querySelector","blurActiveDescendant","ACTIVEDESCENDANT_ATTRIBUTE","focusActiveDescendant","nextActive","scrollIntoView","controller","useMemo","first","passive","last","next","setCurrent","prev","blur","_getActiveDescendant","focus","target","find","predicate","startFrom","showAttributes","hideAttributes","useImperativeHandle","useMergedRefs"],"mappings":"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"}